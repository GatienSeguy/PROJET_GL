@startuml
skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2

title Diagramme de Séquence - Gestion des Datasets

actor Utilisateur as U
participant "UI\n(Tkinter)" as UI #E8F6F3
participant "Serveur IA\n(FastAPI)" as IA #EBF5FB
participant "Serveur Data\n(FastAPI)" as DATA #FDF2E9

== Chargement Initial ==
U -> UI: Lance application
activate UI
UI -> IA: POST /datasets/info_all
activate IA
IA -> DATA: POST /datasets/info_all
activate DATA
DATA -> DATA: construire_json_datasets()
DATA --> IA: {"EURO": {...}, "BTC": {...}}
deactivate DATA
IA --> UI: JSON Datasets
deactivate IA
UI -> UI: JSON_Datasets = data
deactivate UI

== Ajout Dataset ==
U -> UI: Clic "Charger Dataset"
activate UI
UI -> UI: filedialog.askopenfilename()
UI -> UI: Valide avec Pydantic

alt Validation OK
  UI -> IA: POST /datasets/add_dataset
  activate IA
  IA -> DATA: POST /datasets/add_dataset
  activate DATA
  DATA -> DATA: add_new_dataset()
  DATA --> IA: {"ok": true}
  deactivate DATA
  IA --> UI: {"ok": true}
  deactivate IA
  UI -> UI: rafraichir_liste()
else Erreur
  UI -> UI: messagebox.showwarning()
end
deactivate UI

== Suppression Dataset ==
U -> UI: Clic "Supprimer"
activate UI
UI -> IA: POST /datasets/data_suppression_proxy
activate IA
IA -> DATA: POST /datasets/data_supression
activate DATA
DATA -> DATA: remove_dataset()
DATA --> IA: "supprimé"
deactivate DATA
IA --> UI: "supprimé"
deactivate IA
UI -> UI: rafraichir_liste()
deactivate UI

@enduml